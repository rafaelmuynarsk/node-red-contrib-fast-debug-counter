## Overview
This node is based on the official debug node from Node-RED. It displays selected message properties in the debug sidebar tab and optionally the runtime log with the addition of showing a counter of messages on its status.

## How to use
For displaying messages on the sidebar it works exactly as the official debug node:

![](https://raw.githubusercontent.com/rafaelmuynarsk/node-red-contrib-fast-debug-counter/main/gif/debug.gif)

The counter on this node is prepared to receive a huge amount of messages in a short interval of time. The following example has two flows:


1. The first one updates its status on all 10000 messages that are injected on the flow. It takes more than 20 seconds to achieve that.
2. The second one is this node, it only updates the messages when the difference of time between the last message and the actual one is bigger than 100 milliseconds. The counter node receives its result immediatly.

![](https://raw.githubusercontent.com/rafaelmuynarsk/node-red-contrib-fast-debug-counter/main/gif/speed.gif)

### Flows from GIFs:

```json
[{"id":"ac81780c.ea5eb8","type":"subflow","name":"counter","info":"","category":"utils","in":[{"x":640,"y":260,"wires":[{"id":"9db79af4.3b8d18"}]}],"out":[],"env":[],"color":"#FFF0F0","icon":"node-red-contrib-message-counter/message-counter.png","status":{"x":900,"y":160,"wires":[{"id":"6862a135.2ca69","port":0}]}},{"id":"9db79af4.3b8d18","type":"function","z":"ac81780c.ea5eb8","name":"Counter","func":"var count = context.get('count')||0;\ncount += 1;\ncontext.set('count',count);\nmsg.count = count;\nnode.status({fill:\"blue\", shape:\"ring\", text:count});\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":260,"wires":[[]],"icon":"node-red-dashboard/ui_numeric.png"},{"id":"6862a135.2ca69","type":"status","z":"ac81780c.ea5eb8","name":"","scope":null,"x":740,"y":160,"wires":[[]]},{"id":"2dfc2a7b.c67f1e","type":"subflow","name":"queue","info":"SUBFLOW\n\n - line \n - developer: Rafael Muynarsk\n \nCria fila de msg.payload e permite escolher o limite da fila com parâmetro configurável. Este nodo funciona em conjunto com o status node, exec node e spawn node. (Me pergunte caso for reutilizar esse node, ele tem um funcionamento bem particular para a lógica que precisamos)\n\n**Possíveis melhorias:**\n\n * Ao invés de ser uma fila de msg.payload, esse node poderia ser uma fila de objetos JSON. Para a implementação atual isso não é relevante, mas a implementação de uma fila de objetos permitiria um controle mais avançado de fluxos.","category":"essencial","in":[{"x":220,"y":100,"wires":[{"id":"50d72825.7240e8"}]}],"out":[{"x":460,"y":100,"wires":[{"id":"50d72825.7240e8","port":0}]}],"env":[{"name":"limit","type":"num","value":"1"}],"color":"#FDF0C2","icon":"font-awesome/fa-arrows-h","status":{"x":420,"y":220,"wires":[{"id":"6df3a028.ef6b18","port":0}]}},{"id":"6df3a028.ef6b18","type":"status","z":"2dfc2a7b.c67f1e","name":"","scope":["50d72825.7240e8"],"x":300,"y":220,"wires":[[]]},{"id":"50d72825.7240e8","type":"function","z":"2dfc2a7b.c67f1e","name":"queue","func":"let limit = env.get(\"limit\");               // Parameter required\n\nif (msg.stop === true ) { \n    this.sentmessage = 0; \n    this.count = 0;\n    this.line = []; \n    node.status({fill:\"blue\", shape:\"ring\", text: `${count} (${this.sentmessage}/${limit})`});\n    return \n    \n}                        // Exit function and empty queue\nif ( msg.status !== undefined  && (  msg.status.fill === 'blue' ) ) { return }  // Exit function in case msg.status.fill received is equal blue\n\n// setting global variables\nlet file\nlet message_trigger_completion\nlet message_test\nlet message\nif ( msg.status !== undefined && (msg.status.fill === 'green' || msg.status.fill === 'red' || msg.status.fill === 'yellow') ) {\n    message_trigger_completion = true\n} else {\n    message_trigger_completion = false\n}\n\nif ( msg.payload !== undefined ){\n    message = true;\n} else {\n    message = false;\n}\n\nif (!this.count ) {\n    this.count = 0;\n}\nif (!this.sentmessage ) {\n    this.sentmessage = 0;\n}\nif (!this.line ) {\n    this.line = []\n}\n/////////////////////////////////////////////\n\n// Logic when a message arrives\nif ( message === true ){\n    this.count += 1;\n    const json = `\\n { \"this.count\": ${this.count}, \"message\": \"${msg.payload}\"}`     // write new state to context filename\n    if ( this.sentmessage < limit ){\n        sendMessage(json)\n    } else {\n        this.line[this.count] = json\n    }\n}\n\n// Logic when a message that indicates completion arrives\nif ( message_trigger_completion === true ) {\n    if ( this.sentmessage > 0 ){\n        this.sentmessage--\n    }\n    if ( this.sentmessage < limit ) {\n        if ( this.count > 0 ){\n            const lastline =  getLastLineOnVector()\n            sendMessage(lastline)\n        }\n    }\n}\n\nnode.status({fill:\"blue\", shape:\"ring\", text: `${count} (${this.sentmessage}/${limit})`});\n\n/////////////////////////////////////////////////////////////\n//                  Auxiliary functions\n/////////////////////////////////////////////////////////////\n\nfunction getLastLineOnVector(){\n    let line = this.line[1]\n    if ( line !== undefined ){\n        this.line.splice(1,1);\n    }\n    return line\n}\n\nfunction sendMessage(lastline){\n    if ( lastline !== undefined ){\n        msg.payload = JSON.parse(lastline).message\n        if ( msg.status !== undefined ){\n            msg.status = \"\"\n        }\n        delete msg.payload.status;\n        node.send(msg)\n        this.count--\n        this.sentmessage++\n    }\n}","outputs":1,"noerr":0,"x":350,"y":100,"wires":[[]],"icon":"font-awesome/fa-arrows-h"},{"id":"6cc2801.031d68","type":"subflow","name":"exec node","info":"SUBFLOW\n - exec node (Executa e imprime resultado ao concluir)\n - developer: Rafael Muynarsk\n\nEste nodo possuí um subflow que permite a execução de outras linguagens de programação dentro do Node-RED, o parâmetro \"language\" irá executar o template recebido com a linha de comando instalada no sistema operacional. As linguagens de programação aceitas são:\n\n - bash\n - python3\n - node\n - php -f\n - awk -f\n - octave\n - psql postgresql://user:passwds@host:port/database -f\n \n\nOBS: Este nodo possuí uma saída formatada para ser capturada pelo nodo \"catch\" em caso de erro, warning ou execução realizada com sucesso.","category":"essencial","in":[{"x":220,"y":220,"wires":[{"id":"c2260d5.e61d5f"}]}],"out":[{"x":780,"y":220,"wires":[{"id":"eb04588f.200418","port":0}]}],"env":[{"name":"developer","type":"str","value":""},{"name":"language","type":"str","value":""}],"color":"#E38889","icon":"node-red/cog.svg","status":{"x":540,"y":300,"wires":[{"id":"c6dee594.92f7f8","port":0}]}},{"id":"c2260d5.e61d5f","type":"function","z":"6cc2801.031d68","name":"Exec Node","func":"const exec = global.get('child_process').exec;\n\nconst developer = env.get(\"developer\");                            // Parameter Required\nconst timestamp = Date.now()                    \nconst language = env.get(\"language\");\n\n// Handling Node-RED node status\nvar count = context.get('count')||0;\ncount += 1;\ncontext.set('count',count);\nnode.status({fill:\"blue\", shape:\"ring\", text:`Executing (${count})`});\n\n// Create script file\nshellcode=`\nfile=$(mktemp)\ncat > $file <<- \"EOF\"\n${msg.source}\nEOF\n\n${language} $file\n`\n// Exec Script\nexec(shellcode, {shell: '/bin/bash', maxBuffer: 1024 * 400000}, (err, stdout, stderr) => {\n    // Handling Node-RED node status counter\n    var count = context.get('count')||0;\n    count -= 1;\n    context.set('count',count);\n    if (err) {\n        // Handling Kibana logs on error\n        const error = {}\n        error.developer = developer\n        error.timestamp = timestamp\n        error.name = node.name\n        error.type = 'error'\n        error.code = err.code\n        error.killed = err.killed\n        error.payload = msg.payload\n        error.stderr = stderr\n        const message = JSON.stringify(error)\n        node.error(message, msg)\n        \n        // Handling Node-RED node status\n        node.status({fill:\"red\", shape:\"ring\", text:'error'});\n        if ( count > 0 ){\n        node.status({fill:\"blue\", shape:\"ring\", text:`Executing (${count})`});\n        }\n    } else {\n        // Handling Kibana logs\n        const error = {}\n        if ( stderr ){\n            error.developer = developer\n            error.timestamp = timestamp\n            error.name = node.name\n            error.type = 'warning'\n            error.payload = msg.payload\n            error.stderr = stderr\n            const message = JSON.stringify(error)\n            node.error(message, msg)\n            \n            // Handling Node-RED node status\n            node.status({fill:\"yellow\", shape:\"ring\", text:'idle'})\n            if ( count > 0 ){\n                node.status({fill:\"blue\", shape:\"ring\", text:`Executing (${count})`});\n            }\n        } else {\n            error.developer = developer\n            error.timestamp = timestamp\n            error.name = node.name\n            error.type = 'successful'\n            error.payload = msg.payload\n            const message = JSON.stringify(error)\n            node.error(message, msg)   \n            \n            // Handling Node-RED node status\n            node.status({fill:\"green\", shape:\"ring\", text:'idle'})\n            if ( count > 0 ){\n                node.status({fill:\"blue\", shape:\"ring\", text:`Executing (${count})`});\n            }\n        }\n        \n        // Sending message to the next node\n        if (stdout){\n            msg.payload = stdout;\n            node.send(msg);\n        }\n    }\n    // Erasing msg.source from msg\n    delete msg.source\n})","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":220,"wires":[["2452a02a.58d73"]]},{"id":"c6dee594.92f7f8","type":"status","z":"6cc2801.031d68","name":"","scope":null,"x":380,"y":300,"wires":[[]]},{"id":"2452a02a.58d73","type":"split","z":"6cc2801.031d68","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":true,"addname":"","x":495,"y":220,"wires":[["eb04588f.200418"]],"l":false},{"id":"eb04588f.200418","type":"switch","z":"6cc2801.031d68","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":575,"y":220,"wires":[[]],"l":false},{"id":"7c4b0d827a0aa0a2","type":"tab","label":"Flow 1","disabled":false,"info":"","env":[]},{"id":"da9db9af924b6449","type":"exec queue","z":"7c4b0d827a0aa0a2","name":"","currentLine":{"row":0,"column":7},"command":"python3 $file ","debugMode":false,"outputs":1,"useSpawn":"false","field":"payload","fieldType":"msg","format":"sh","template":"print('[ \"teste\", \"mamfdkdf\" ]')","output":"parsedJSON","outputEmpty":false,"vimMode":true,"queue":"15","addpayCB":false,"splitLine":false,"cleanQueue":true,"x":410,"y":140,"wires":[[]]},{"id":"7f1b10e6a5f56dab","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":140,"wires":[["da9db9af924b6449"]]},{"id":"6e263a883f2b7f75","type":"debug","z":"7c4b0d827a0aa0a2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":575,"y":260,"wires":[],"l":false},{"id":"ef9926331724df64","type":"exec queue","z":"7c4b0d827a0aa0a2","name":"npm install","currentLine":{"row":0,"column":2},"command":"bash $file ","debugMode":false,"outputs":1,"useSpawn":"true","field":"payload","fieldType":"msg","format":"sh","template":"cd $HOME/.node-red\nnpm install node-jq\nnpm install mktemp\nnpm install queue\nnpm install xml-js\n","output":"str","outputEmpty":false,"vimMode":true,"queue":"1","addpayCB":false,"splitLine":false,"cleanQueue":true,"x":310,"y":60,"wires":[["5e0d63cb76e6762c"]]},{"id":"56f77312b0307bdb","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":175,"y":60,"wires":[["ef9926331724df64"]],"l":false},{"id":"5e0d63cb76e6762c","type":"debug","z":"7c4b0d827a0aa0a2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":445,"y":60,"wires":[],"l":false},{"id":"4cf8e7af2cf3ad68","type":"service","z":"7c4b0d827a0aa0a2","name":"","currentLine":{"row":4,"column":0},"command":"node $file   ","debugMode":false,"outputs":1,"inputs":0,"field":"payload","fieldType":"msg","format":"javascript","template":"// setInterval(() => {\n// \tconsole.log('{\"teste\": 5}')\t\n// }, 2000)\n\n","output":"str","inputTrigger":false,"vimMode":true,"addpayCB":false,"splitLine":true,"cleanQueue":true,"x":230,"y":380,"wires":[["0ca987648ee884c5"]]},{"id":"627e6fa40376b869","type":"debug","z":"7c4b0d827a0aa0a2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":850,"y":380,"wires":[]},{"id":"3761dce7f3b60293","type":"function","z":"7c4b0d827a0aa0a2","name":"","func":"for (let i = 0; i < 10000; i++) {\n\tnode.send(msg)\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":500,"wires":[["4c951a0e087292ae"]]},{"id":"995bddcca1b0500e","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":500,"wires":[["3761dce7f3b60293"]]},{"id":"0ca987648ee884c5","type":"exec queue","z":"7c4b0d827a0aa0a2","name":"","currentLine":{"row":0,"column":3},"command":"bash $file   ","debugMode":false,"outputs":1,"useSpawn":"false","field":"payload","fieldType":"msg","format":"sh","template":"echo \"eu estou aqui\"","output":"str","outputEmpty":false,"vimMode":true,"queue":"15","addpayCB":false,"splitLine":true,"cleanQueue":true,"x":410,"y":380,"wires":[["627e6fa40376b869"]]},{"id":"4c951a0e087292ae","type":"exec queue","z":"7c4b0d827a0aa0a2","name":"","currentLine":{"row":1,"column":0},"command":"bash $file ","debugMode":false,"outputs":1,"useSpawn":"false","field":"payload","fieldType":"msg","format":"sh","template":"echo \"teste\"\n","output":"str","outputEmpty":false,"vimMode":true,"queue":"12","addpayCB":false,"splitLine":true,"cleanQueue":true,"x":590,"y":500,"wires":[["db0702fef0890d64"]]},{"id":"a7f68b3e353b4fa7","type":"subflow:6cc2801.031d68","z":"7c4b0d827a0aa0a2","name":"","env":[{"name":"language","value":"bash","type":"str"}],"x":950,"y":680,"wires":[["74b57d5b5dd30fe0"]]},{"id":"eb30b83a2e9364fb","type":"template","z":"7c4b0d827a0aa0a2","name":"","field":"source","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"echo \"eu estou aqui\"","output":"str","x":740,"y":680,"wires":[["a7f68b3e353b4fa7"]]},{"id":"502cd9ed2a54e2fd","type":"function","z":"7c4b0d827a0aa0a2","name":"","func":"for (let i = 0; i < 1000; i++) {\n\tnode.send(msg)\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":680,"wires":[["b7bccf7523bc5f3a"]]},{"id":"362204c3e202da39","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":680,"wires":[["502cd9ed2a54e2fd"]]},{"id":"2e8c25f6c3d18642","type":"status","z":"7c4b0d827a0aa0a2","name":"","scope":["a7f68b3e353b4fa7"],"x":360,"y":600,"wires":[["b7bccf7523bc5f3a"]]},{"id":"4527d5cd2d4f607c","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":740,"wires":[["b7bccf7523bc5f3a"]]},{"id":"74b57d5b5dd30fe0","type":"debug","z":"7c4b0d827a0aa0a2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1210,"y":680,"wires":[]},{"id":"b7bccf7523bc5f3a","type":"subflow:2dfc2a7b.c67f1e","z":"7c4b0d827a0aa0a2","name":"","env":[{"name":"limit","value":"10","type":"num"}],"x":570,"y":680,"wires":[["eb30b83a2e9364fb"]]},{"id":"78b94e225803c6b7","type":"catch","z":"7c4b0d827a0aa0a2","name":"","scope":null,"uncaught":false,"x":220,"y":880,"wires":[["de56532edd8d5bc6"]]},{"id":"de56532edd8d5bc6","type":"debug","z":"7c4b0d827a0aa0a2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":880,"wires":[]},{"id":"aaccf33d425de5e4","type":"exec queue","z":"7c4b0d827a0aa0a2","name":"counter","currentLine":{"row":1,"column":9},"command":"bash $file ","debugMode":false,"outputs":0,"useSpawn":"false","field":"payload","fieldType":"msg","format":"sh","template":"echo \"teste\"\nsleep 100","output":"str","outputEmpty":true,"vimMode":true,"queue":"1","addpayCB":false,"splitLine":true,"cleanQueue":true,"x":220,"y":1080,"wires":[]},{"id":"87321ded791e357e","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":800,"y":280,"wires":[["b4bbbf905b3ab69c"]]},{"id":"937a5d11e9d7c07d","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":440,"y":260,"wires":[["6e263a883f2b7f75"]]},{"id":"db0702fef0890d64","type":"counter","z":"7c4b0d827a0aa0a2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":775,"y":500,"wires":[],"l":false},{"id":"b4bbbf905b3ab69c","type":"counter","z":"7c4b0d827a0aa0a2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":945,"y":280,"wires":[],"l":false},{"id":"5bcded39a42c5ed8","type":"counter","z":"7c4b0d827a0aa0a2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":860,"y":1060,"wires":[]},{"id":"f66779e5f1b18c9b","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1060,"wires":[["5bcded39a42c5ed8"]]},{"id":"272f68f648c3d021","type":"function","z":"7c4b0d827a0aa0a2","name":"send 10000 messages","func":"for (let i = 0; i < 10000; i++) {\n\tnode.send(msg)\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":1260,"wires":[["032ee4a616946502"]]},{"id":"1fd336bfc7160816","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1260,"wires":[["272f68f648c3d021"]]},{"id":"1cce5577affd9d01","type":"counter","z":"7c4b0d827a0aa0a2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1100,"y":1340,"wires":[]},{"id":"032ee4a616946502","type":"subflow:ac81780c.ea5eb8","z":"7c4b0d827a0aa0a2","name":"","x":1100,"y":1260,"wires":[]},{"id":"af40245a80b29d38","type":"function","z":"7c4b0d827a0aa0a2","name":"send 10000 messages","func":"for (let i = 0; i < 10000; i++) {\n\tnode.send(msg)\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":1340,"wires":[["1cce5577affd9d01"]]},{"id":"0170aab234595536","type":"inject","z":"7c4b0d827a0aa0a2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1340,"wires":[["af40245a80b29d38"]]},{"id":"ea154a4a74aae2b5","type":"comment","z":"7c4b0d827a0aa0a2","name":"First sampe ","info":"","x":790,"y":1000,"wires":[]},{"id":"25b93c161eba9f6e","type":"comment","z":"7c4b0d827a0aa0a2","name":"Second sample","info":"","x":800,"y":1200,"wires":[]}]
```

